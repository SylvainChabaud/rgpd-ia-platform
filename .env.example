# ============================================================================
# RGPD-IA Platform - Environment Configuration Template
# ============================================================================
#
# SECURITY WARNING:
# - DO NOT commit this file with real secrets
# - Copy to .env and replace ALL placeholders
# - .env is git-ignored and MUST NEVER be committed
#
# PRODUCTION SETUP:
#   1. cp .env.example .env
#   2. Generate secrets: ./scripts/docker/init-secrets.sh
#   3. Edit .env with your values
#   4. Verify: ./scripts/docker/security-check.sh
#
# ============================================================================

# ----------------------------------------------------------------------------
# Environment
# ----------------------------------------------------------------------------
NODE_ENV=production
PORT=3000

# ----------------------------------------------------------------------------
# Database Configuration (PostgreSQL 16)
# ----------------------------------------------------------------------------
DB_USER=rgpd_user
DB_PASSWORD=REPLACE_WITH_STRONG_PASSWORD
DB_NAME=rgpd_platform

# Database URL (for migrations and local access)
# Production: uses Docker secrets in docker-compose.yml
DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@db:5432/${DB_NAME}

# ----------------------------------------------------------------------------
# Security Secrets (CRITICAL - Generate unique values)
# ----------------------------------------------------------------------------
# Generate with: openssl rand -hex 32
#
# SESSION_SECRET: Used for session signing (Express/Next.js)
# JWT_SECRET: Used for JWT token signing (IAM)
# BOOTSTRAP_PLATFORM_SECRET: Used for platform bootstrap CLI
#
# ⚠️ PRODUCTION: Use Docker secrets (secrets/*.txt files)
# ⚠️ DEVELOPMENT: Generate and store in .env (NOT .env.example)

SESSION_SECRET=REPLACE_WITH_SESSION_SECRET_64_CHARS_HEX
JWT_SECRET=REPLACE_WITH_JWT_SECRET_64_CHARS_HEX
BOOTSTRAP_PLATFORM_SECRET=REPLACE_WITH_BOOTSTRAP_SECRET_64_CHARS_HEX

# ----------------------------------------------------------------------------
# Feature Flags
# ----------------------------------------------------------------------------
# Enable bootstrap mode (ONLY for initial platform setup)
# Set to true during development setup, false in production
BOOTSTRAP_MODE=false

# ----------------------------------------------------------------------------
# Observability (LOT 6.1)
# ----------------------------------------------------------------------------
# LOG_LEVEL: error | warn | info | debug
# ⚠️ Production: use 'info' or 'warn' (debug exposes too much)
LOG_LEVEL=info

# ----------------------------------------------------------------------------
# AI Gateway Configuration (LOT 3.0)
# ----------------------------------------------------------------------------
# AI_PROVIDER: stub (safe default) | ollama (local LLM)
AI_PROVIDER=stub

# Ollama Configuration (if AI_PROVIDER=ollama)
# Docker: use service name 'ollama'
# Local: use 'localhost' or '127.0.0.1'
OLLAMA_URL=http://ollama:11434
OLLAMA_MODEL=tinyllama
OLLAMA_TIMEOUT=30000

# ----------------------------------------------------------------------------
# TLS/SSL Configuration (Reverse Proxy)
# ----------------------------------------------------------------------------
# Domain for Let's Encrypt certificate
# DOMAIN=example.com
# SSL_EMAIL=admin@example.com

# ----------------------------------------------------------------------------
# RGPD Configuration (LOT 5.x)
# ----------------------------------------------------------------------------
# Export TTL (in days) - default 7 days
RGPD_EXPORT_TTL_DAYS=7

# ----------------------------------------------------------------------------
# Email Encryption (LOT 1.6 - Art. 15, 34 RGPD)
# ----------------------------------------------------------------------------
# AES-256-GCM key for encrypting user emails
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# Format: 64 hex characters (32 bytes) OR base64 (44 chars)
#
# Used for:
# - User accessing their own email (Art. 15)
# - DPO accessing emails for breach notifications (Art. 34)
# - System sending password reset / alerts
#
# ⚠️ CRITICAL: Store securely, rotate periodically, backup before rotation
EMAIL_ENCRYPTION_KEY=REPLACE_WITH_EMAIL_ENCRYPTION_KEY_64_CHARS_HEX

# Purge delay (in days) - default 30 days after soft delete
RGPD_PURGE_DELAY_DAYS=30

# ----------------------------------------------------------------------------
# CORS Configuration (LOT 5.3)
# ----------------------------------------------------------------------------
# Allowed origins for CORS (comma-separated)
# Production: use your frontend domain(s)
# Development: use localhost ports
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# ----------------------------------------------------------------------------
# EPIC 9 — Incident Response & Security Alerting (LOT 9.0)
# ----------------------------------------------------------------------------
# Email Configuration for Incident Alerts
# Multiple recipients: use comma-separated emails

# DPO (Data Protection Officer) - Receives CNIL notification incidents
ALERT_DPO_EMAILS=dpo@example.com

# DevOps Team - Receives infrastructure & availability incidents
ALERT_DEVOPS_EMAILS=devops@example.com,sre@example.com

# Security Team - Receives all security incidents
ALERT_SECURITY_EMAILS=security@example.com,rssi@example.com

# Slack Integration (Optional - for HIGH/CRITICAL incidents)
# Create webhook: https://api.slack.com/messaging/webhooks
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
# SLACK_CHANNEL=#security-alerts

# PagerDuty Integration (Optional - for CRITICAL incidents only)
# Create integration: https://support.pagerduty.com/docs/services-and-integrations
# PAGERDUTY_ROUTING_KEY=YOUR_PAGERDUTY_ROUTING_KEY

# Dashboard URL (for links in alert emails)
DASHBOARD_URL=https://rgpd-platform.example.com

# ----------------------------------------------------------------------------
# EPIC 9 — Security Incident Detection Thresholds (LOT 9.0)
# ----------------------------------------------------------------------------
# Brute Force Detection
DETECTION_BRUTE_FORCE_ATTEMPTS=10
DETECTION_BRUTE_FORCE_WINDOW_MINUTES=5

# Mass Export Detection (RGPD compliance)
DETECTION_MASS_EXPORT_RECORDS=10000
DETECTION_MASS_EXPORT_WINDOW_MINUTES=60

# Backup Failure Detection
DETECTION_BACKUP_CONSECUTIVE_FAILURES=2

# ----------------------------------------------------------------------------
# EPIC 9 — Security Scanning (LOT 9.1)
# ----------------------------------------------------------------------------
# Fail CI/CD on HIGH/CRITICAL vulnerabilities
FAIL_ON_HIGH=true

# Security scan schedule (cron format for weekly scans)
# Default: Sunday 2:00 AM UTC
# SECURITY_SCAN_SCHEDULE=0 2 * * 0

# ----------------------------------------------------------------------------
# EPIC 9 — Chaos Engineering (LOT 9.2)
# ----------------------------------------------------------------------------
# Maximum recovery time for container restart (seconds)
MAX_RECOVERY_TIME_SECONDS=30

# RTO (Recovery Time Objective) for database restore (hours)
RTO_DATABASE_HOURS=4

# RPO (Recovery Point Objective) for data loss (hours)
RPO_DATABASE_HOURS=1

# Backup retention (days)
BACKUP_RETENTION_HOT_DAYS=30
BACKUP_RETENTION_COLD_DAYS=90
BACKUP_RETENTION_ARCHIVE_DAYS=365

# ----------------------------------------------------------------------------
# Test Credentials (For E2E tests and local development)
# ----------------------------------------------------------------------------
# Default test users created by scripts/setup-dev.bat and tests/e2e/setup/seed-test-data.ts
# ⚠️ DEVELOPMENT ONLY - Change these in production

# Platform Super Admin
TEST_PLATFORM_ADMIN_EMAIL=admin@platform.local
TEST_PLATFORM_ADMIN_PASSWORD=Admin1234
TEST_PLATFORM_ADMIN_NAME=Platform Administrator

# Tenant Admin (for test tenant)
TEST_TENANT_ADMIN_EMAIL=admin@tenant1.local
TEST_TENANT_ADMIN_PASSWORD=Admin1234
TEST_TENANT_ADMIN_NAME=Tenant Administrator

# Test Tenant
TEST_TENANT_NAME=Acme Corp
TEST_TENANT_SLUG=acme

# Password hashing salt (for deterministic test data)
# ⚠️ ONLY for tests - Production uses random salt per user
TEST_PASSWORD_SALT=testsalt1234567890abcdef

# ----------------------------------------------------------------------------
# Docker Development Override (docker-compose.dev.yml)
# ----------------------------------------------------------------------------
# DB_USER=devuser
# DB_PASSWORD=devpass
# AI_PROVIDER=stub
# LOG_LEVEL=debug
# ALERT_DPO_EMAILS=dpo-dev@localhost
# ALERT_DEVOPS_EMAILS=devops-dev@localhost
# ALERT_SECURITY_EMAILS=security-dev@localhost
